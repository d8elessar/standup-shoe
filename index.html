<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <link rel="stylesheet" href="css/style.css">
  <meta name="description" content="">

  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">
  <meta property="og:image:alt" content="">

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icon.png">

  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#fafafa">


  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f7f7f7;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #005990;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      background-color: white;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 12px 15px;
      text-align: left;
    }

    thead {
      background-color: #005990;
      color: white;
    }

    tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    .event-name {
      font-family: monospace;
      font-weight: bold;
      color: #d63384;
    }

    .status {
      font-weight: bold;
    }

    .triggered {
      background-color: #d1e7dd !important;
      /* Light green for triggered rows */
    }

    .triggered .status {
      color: #0f5132;
    }
  </style>
</head>

<body>

  <!-- Add your site or application content here -->
  <p>Hello world! This is HTML5 Boilerplate.</p>
  <script src="js/app.js"></script>

  <!--img src="https://driftinginandoutofsteel.wordpress.com/wp-content/uploads/2017/02/solong.jpg" -->

  <h1>Salesforce Embedded Messaging Event Log</h1>
  <p>Interact with the chat widget to see the events below update in real-time.</p>

  <table>
    <thead>
      <tr>
        <th>Event Name</th>
        <th>Status</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody id="event-log-body">
    </tbody>
  </table>


  <script type='text/javascript'>
    function initEmbeddedMessaging() {
      try {
        embeddedservice_bootstrap.settings.language = 'de'; // For example, enter 'en' or 'en-US'
        embeddedservice_bootstrap.settings.hideChatButtonOnLoad = true;
		embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot = true;

        embeddedservice_bootstrap.init(
          '00D9O00000HhV0L',
          'OXG_Web_Deployment',
          'https://oxg--uat.sandbox.my.site.com/ESWOXGChannel1753267383010',
          {
            scrt2URL: 'https://oxg--uat.sandbox.my.salesforce-scrt.com'
          }
        );
      } catch (err) {
        console.error('Error loading Embedded Messaging: ', err);
      }
    };
  </script>
  <script type='text/javascript'
    src='https://oxg--uat.sandbox.my.site.com/ESWOXGChannel1753267383010/assets/js/bootstrap.min.js'
    onload='initEmbeddedMessaging()'></script>




  <script>
    window.addEventListener(
      "onEmbeddedMessagingButtonCreated", () => {
        console.log('Button Created. Waiting for user to use the mouse wheel.');

        // 1. Create a flag to make sure our code only runs ONCE.
        let isActionTriggered = false;

        // 2. Define the event handler as a NAMED function so we can remove it later.
        const handleWheelAction = (event) => {
          // If the action has already been triggered, do nothing.
          if (isActionTriggered) {
            return;
          }

          // Set the flag to true immediately to prevent this from running again.
          isActionTriggered = true;

          console.log('Wheel event detected. Showing chat button.');
          embeddedservice_bootstrap.utilAPI.showChatButton();

          // --- Start a 5-second timer to launch the chat ---
          console.log('Starting 5-second timer to launch chat...');
          setTimeout(() => {
            console.log('Timer finished. Launching chat.');
            embeddedservice_bootstrap.utilAPI.launchChat()
              .then(() => {
                console.log('Chat launched successfully.');
              })
              .catch((err) => {
                console.error('Chat launch failed.', err);
              });
          }, 5000); // 5000 milliseconds = 5 seconds

          // 3. For efficiency, correctly remove the listener now that its job is done.
          window.removeEventListener('wheel', handleWheelAction);
        };

        // 4. Add the event listener to the window.
        window.addEventListener('wheel', handleWheelAction);
      }
    );
  </script>




  <script>
    // This is the main entry point. It ensures the SF script is fully loaded.
    window.addEventListener('onEmbeddedMessagingReady', () => {
      console.log('Salesforce Messaging is Ready. Setting up event logger...');

      // --- All of your event table logic now goes inside here ---
      const salesforceEvents = [
        "onEmbeddedMessagingBusinessHoursEnded",
        "onEmbeddedMessagingBusinessHoursStarted",
        "onEmbeddedMessagingButtonCreated",
        "onEmbeddedMessagingButtonClicked",
        "onEmbeddedMessagingConversationClosed",
        "onEmbeddedMessagingConversationOpened",
        "onEmbeddedMessagingConversationParticipantChanged",
        "onEmbeddedMessagingConversationRouted",
        "onEmbeddedMessagingConversationStarted",
        "onEmbeddedMessageDelivered",
        "onEmbeddedMessagingIdentityTokenExpired",
        "onEmbeddedMessagingIdentityTokenExpired",
        "onEmbeddedMessagingIdentityTokenExpired",
        "onEmbeddedMessagingIdentityTokenExpired",
        "onEmbeddedMessagingPreChatLoaded",
        "onEmbeddedMessagingPreChatSubmitted",
        "onEmbeddedMessageLinkClicked",
        "onEmbeddedMessageRead",
        "onEmbeddedMessagingReady",
        "onEmbeddedMessageSent",
        "onEmbeddedMessagingTranscriptDownloadSuccessful",
        "onEmbeddedMessagingTranscriptRequested",
        "onEmbeddedMessagingTranscriptRequestFailed",
        "onEmbeddedMessagingWindowClosed",
        "onEmbeddedMessagingWindowMinimized",
        "onEmbeddedMessagingWindowMaximized"
      ];

      const tableBody = document.getElementById('event-log-body');

      // 1. Populate the table
      salesforceEvents.forEach(eventName => {
        const row = document.createElement('tr');
        row.id = `row-${eventName}`;
        row.innerHTML = `
        <td class="event-name">${eventName}</td>
        <td class="status" id="status-${eventName}">Not Triggered</td>
        <td id="time-${eventName}">---</td>
      `;
        tableBody.appendChild(row);
      });

      // 2. Create the handler function
      const logEventHandler = (event) => {
        const eventName = event.type;
        console.log(`Event Fired: ${eventName}`, event.detail || '(No data)');
        const row = document.getElementById(`row-${eventName}`);
        const statusCell = document.getElementById(`status-${eventName}`);
        const timeCell = document.getElementById(`time-${eventName}`);
        if (row && statusCell && timeCell) {
          row.classList.add('triggered');
          statusCell.textContent = 'âœ… Triggered';
          timeCell.textContent = new Date().toLocaleTimeString();
        }
      };

      // 3. Add a listener for each event (NOW it will work correctly)
      salesforceEvents.forEach(eventName => {
        window.addEventListener(eventName, logEventHandler);
      });

      // Manually trigger the 'onEmbeddedMessagingReady' event in our table since we are inside it
      logEventHandler({ type: 'onEmbeddedMessagingReady' });
    });

    // This proactive chat logic can remain separate, as it listens for a different event.
    window.addEventListener(
      "onEmbeddedMessagingButtonCreated", () => {
        console.log('Button Created. Waiting for user to use the mouse wheel.');
        let isActionTriggered = false;

        const handleWheelAction = (event) => {
          if (isActionTriggered) return;
          isActionTriggered = true;

          console.log('Wheel event detected. Showing chat button.');
          embeddedservice_bootstrap.utilAPI.showChatButton();

          setTimeout(() => {
            console.log('Timer finished. Launching chat.');
            embeddedservice_bootstrap.utilAPI.launchChat()
              .then(() => console.log('Chat launched successfully.'))
              .catch((err) => console.error('Chat launch failed.', err));
          }, 5000);

          window.removeEventListener('wheel', handleWheelAction);
        };

        window.addEventListener('wheel', handleWheelAction);
      }
    );
  </script>

</body>

</html>